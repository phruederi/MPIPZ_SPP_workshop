
### Hands-on session - Whole-genome assembly and annotation

#### Quality control with FastQC

FastQC is a software for quickly assessing the quality of sequencing reads. It supports a wide range of analyses such as quality per base distribution, GC-content per base distribution, overrepresentation of certain sequence motifs such as adapter sequences, etc. Run:

`fastqc`

Load Leaf21_R1.fastq.gz and inspect the different panels. Is there anything you note? Have the sequencing adapters been removed? Have the reads been quality trimmed?

#### Assembly with MegaHit

MegaHit is an ultra fast assembler originally developed for metagenomic assembly, but has proved to be very efficient for single microbial genome assembly. We will use it to assemble the Leaf41 isolate.
Megahit takes as input FastQ files. Here we have paired-end Illumina reads. Megahit also support GPU computation.

`megahit --k-max 81 -1 ./data/wgs/Leaf41_R1.fastq.gz -2 ./data/wgs/Leaf41_R2.fastq.gz --cpu-only -o megahit_Leaf41_out`

(takes around 15 mins to finish).

Inspect assembly

`less megahit_Leaf41_out/final.contigs.fa`

Get the number of contigs

`grep -c ">" megahit_Leaf41_out/final.contigs.fa`

Not much more to see here for now.

#### Assembly quality with QUAST

We will use QUAST to assess the assembly quality of the Leaf41 Isolate.

`quast.py ./data/wgs/Leaf41.fna megahit_Leaf41_out/final.contigs.fa`

Is there anything you note?

Open up PDF ./data/wgs/Leaf41.pdf and inspect the plots. Now we use Quast to compare the MegaHit assembly of Leaf41 with a pre-computed assembly conducted with the M5 assembler. Which assembly is better?

#### Annotation with PROKKA

We will employ PROKKA to annotate our Leaf41 isolate. Prokka will perform gene calling and uses a hierarchical approach to assign functions to the found genes.

`prokka ./data/wgs/Leaf41.fna --cpus 4 -o prokka_Leaf41_out`

(takes ~4 mins)

Let's inspect the results

`cd prokka_Leaf41_out`

`less PROKKA_04042017.faa`

These are the protein sequences with a unique id and the gene product in the header. How many protein are there overall?

`grep -c ">" prokka_Leaf41_out/PROKKA_04042017.faa`

How many hypothetical proteins / protein without a gene product are there?

`grep -c "hypothetical protein" PROKKA_04042017.tsv`

#### Trait inference with Traitar

We will use Traitar to predict microbial traits for the Leaf41 isolate. Traitar is a phenotyping software that can predict 67 diverse traits related to bacterial physiology and morphology.

`traitar phenotype prokka_Leaf41_out/ sample_table.txt from_genes traitar_leaf41_out`
(takes ~10 mins)

Let's inspect the traits predicted with Traitar by opening up PDF traitar_leaf41_out/phenotype_prediction/heatmap_combined.pdf

Now we'd like to find out, which genes and protein families were responsible for the phenotype predictions.

`less traitar_leaf41_out/phenotype_prediction/phypat/feat_gffs/Leaf21_important_features.dat`

What gene and Pfam does Traitar report for the prediction of D-Mannitol?

#### Pan genome inference with Roary

We switch to a different data set here, which consists of 5 Listeria monocytogenes genomes. We will use Roary to determine the pan genome from the single genomes. We will work with pre-computed annotations generated by Prokka.

`cd ./data/wgs/Listeria`

`roary -f roary_out gff/*gff -e -n -v -p 3`

(takes ~25 mins)

Roary will provide us with a overview of the pan genome

`less roary_out/summary_statistics.txt`

Why do you think the set of cloud and soft core genes is empty?

#### Tree inference with FastTree

Roary also produces an alignmnent of the core genes common to all isolate genomes "core_gene_alignment.aln". We will use Roary to infer a tree from this nucleotide alignment using the general time reversible model (GTR+CAT), which is a model of evolution.

`FastTree -gtr -nosupport roary_out/core_gene_alignment.aln > listeria_tree`

(takes ~10 mins)

